{
  "name": "Workshop-popgenome",
  "tagline": "Tutorial about R package PopGenome",
  "body": "Ressourcen and Preparation\r\n============\r\n\r\nResources: \r\n- Online: <http://tonig-evo.github.io/workshop-popgenome>\r\n- Datafiles: [PopGenome_data.zip](PopGenome_data.zip)\r\n- Solutions: [solutions.md](solutions.md)\r\n\r\nPDFs:\r\n- <https://github.com/tonig-evo/workshop-popgenome/blob/master/An_introduction_to_the_PopGenome_package.pdf>\r\n- <https://github.com/tonig-evo/workshop-popgenome/blob/master/PopGenome.pdf>\r\n- <https://github.com/tonig-evo/workshop-popgenome/blob/master/Whole_genome_analyses_using_VCF_files.pdf>\r\n\r\nTo work on iceberg, copy necessary files from fastdata\r\n```\r\nmkdir PopGenome\r\ncd PopGenome\r\ncp /usr/local/extras/Genomics/workshops/March2016/PopGenome/PopGenome_data.zip ./\r\nunzip PopGenome_data.zip\r\nrm PopGenome_data.zip\r\n```\r\n\r\nIntroduction\r\n============\r\n\r\nPopGenome is an R package\r\n(<https://cran.r-project.org/web/packages/PopGenome/index.html>) for\r\nanalyses of population genomic data. For this\r\ntutorial, please make sure that your R working directory is set\r\ncorrectly and you have all the packages installed, e.g.\r\ninstall.packages(\"PopGenome\"). The following files are necessary to\r\nconduct this practical session:\r\n\r\n-   fasta_file.txt, a fasta file for one locus from different\r\n    *Arabidopsis thaliana* individuals (accessions) and the outgroup\r\n    sequence from *Arabidopsis lyrata* in the folder **fasta**\r\n\r\n-   LGE22.gff, LGE22.vcf, LGE22.fa in subfolders in the folder\r\n    **great_tit**\r\n\r\n-   variants.vcf, ind_species1.txt, ind_species2.txt, rad_assembly.fa\r\n    in the folder **rad**\r\n\r\nTo get an overview about the file contents, inspect files with a text\r\nEditor (e.g. Notepad+) or via the command line (e.g. more) before\r\nstarting to work on them.\r\n\r\nLoad library into R\r\n===================\r\n\r\n```R\r\n# Loading module \r\nlibrary(PopGenome)\r\n```\r\n\r\nFasta Files\r\n===========\r\n\r\nReading Fasta Files\r\n-------------------\r\n\r\n```R\r\n# Reading data, read fasta from folder \r\nGENOME.class <- readData(\"fasta\") \r\nget.sum.data(GENOME.class)\r\nget.individuals(GENOME.class)\r\n```\r\n\r\n1.What statistics can one obtain from get.sum.data function?\r\n\r\n2.Folders **fasta_a**, **fasta_b**, **fasta_c** contain modified alignments. Identify the differences between the datasets. Why PopGenome fails to load fasta files?\r\n\r\nObtaining summary statistics from alignments\r\n--------------------------------------------\r\n\r\n**Note:** Since calculation of certain population genetic parameter can\r\nbe computational intense, they have to be executed separately\r\nbeforehand. For this modules have to be run. Note that module **Fst**\r\nhas to be executed with **F_st**. The statistic Tajima’s D is part of\r\nthe module **neutrality** not **Fst**\r\n\r\n```R\r\n# Available statistics and examples \r\nshow.slots(GENOME.class) \r\n# Run necessary module \r\nGENOME.class <- F_ST.stats(GENOME.class) \r\nGENOME.class <- neutrality.stats(GENOME.class) \r\nGENOME.class@n.sites \r\nGENOME.class@Pi\r\nGENOME.class@Tajima.D\r\n```\r\n\r\n3.What different modules are available? (show.slots)\r\n\r\n4.What module is necessary to be executed in order to obtain Wall.B?\r\n\r\n5.How could one obtain a per site estimate of Pi?\r\n\r\nObtaining statistics for regions\r\n--------------------------------\r\n\r\n```R\r\n# Available region data and statistics \r\nGENOME.class@region.data\r\nGENOME.class@region.stats \r\n# Examples\r\nGENOME.class@region.data@biallelic.sites[[1]][1:10]\r\nGENOME.class@region.data@transitions[[1]][1:10]\r\n```\r\n\r\n6.How many sites have gaps?\r\n\r\n7.How many singletons are in the dataset? (see also **An_introduction_to_the_PopGenome_package.pdf**, section\r\n3.1)\r\n\r\n8.What is the difference between *region.data* and *region.stats*? (see also **Whole_genome_analyses_using_VCF_files.pdf**, section 11 and 12)\r\n\r\nDefine outgroups and populations\r\n--------------------------------\r\n\r\n**Note:** If one ore more outgroup sequences are defined, PopGenome will\r\nonly consider SNPs where the outgroup is monomorphic; the monomorphic\r\nnucleotide is then automatically defined as the major allele (encoded by\r\n0).\r\n\r\n```R\r\n# Without defining populations \r\nget.individuals(GENOME.class)\r\nGENOME.class <- neutrality.stats(GENOME.class,detail=TRUE)\r\nget.neutrality(GENOME.class)[[1]] \r\n# Define populations with lists\r\nGENOME.class <- set.populations(GENOME.class,list(\r\nc(\"CON\",\"KAS-1\",\"RUB-1\",\"PER-1\",\"RI-0\",\"MR-0\",\"TUL-0\"),\r\nc(\"MH-0\",\"YO-0\",\"ITA-0\",\"CVI-0\",\"COL-2\",\"LA-0\",\"NC-1\") )) \r\n# Check whether grouping is set correctly \r\nGENOME.class@region.data@populations\r\nGENOME.class@region.data@populations2 \r\nGENOME.class@region.data@outgroup\r\n# Recalculate statistics for populations \r\nGENOME.class <-neutrality.stats(GENOME.class,detail=TRUE) \r\nGENOME.class@Tajima.D \r\n# Each population \r\nget.neutrality(GENOME.class)[[1]]\r\nget.neutrality(GENOME.class)[[2]] \r\n# Set an outgroup \r\nGENOME.class <-set.outgroup(GENOME.class,c(\"Alyrata\"))\r\nGENOME.class@region.data@outgroup \r\nGENOME.class <- neutrality.stats(GENOME.class,detail=TRUE)\r\nget.neutrality(GENOME.class)[[1]] \r\nget.neutrality(GENOME.class)[[2]]\r\n```\r\n\r\n9.Name implemented statistics that require an outgroup, e.g. that are\r\ncalculated after defining the outgroup.\r\n\r\n10.What do you have to pay attention to when applying the McDonald-Kreitman\r\ntest?\r\n(see **Whole_genome_analyses_using_VCF_files.pdf**)\r\n\r\nAnalysing VCF files for whole genome data\r\n=========================================\r\n\r\nLoading VCF files\r\n-----------------\r\n\r\nThere are two ways to read in VCF files, either a folder of VCF files\r\nwith **readData** or a single VCF file with **readVCF**. To read a VCF\r\nfile using *readVCF* it needs to be compressed with *bgzip* and indexed\r\nwith *tabix*. The tabix files need to be placed in the same folder as\r\nthe vcf file.\r\n```R\r\n# What parameters need to be defined \r\nGENOME.class <-readVCF(\"great_tit/vcf/LGE22.vcf.gz\", 6000,\"chrLGE22_Parus_Major_build_1.0.2\",1,773534)\r\nGENOME.class@region.names \r\nGENOME.class <- neutrality.stats(GENOME.class, FAST=TRUE) \r\nget.sum.data(GENOME.class) \r\nGENOME.class@region.data\r\n```\r\n11.What parameters need to be defined to *readVCF*? (see **PopGenome.pdf**)\r\n\r\n12.What is the overall diversity (theta and pi) of chromosome LGE22?\r\n\r\nLoading VCF files with annotation\r\n---------------------------------\r\n```R\r\nGENOME2.class <- readData(\"great_tit/vcf2\",format=\"VCF\", gffpath=\"great_tit/gff\") \r\nget.sum.data(GENOME2.class)\r\nGENOME2.class@region.data \r\nGENOME2.class <- set.synnonsyn(GENOME2.class, ref.chr=\"great_tit/fasta/LGE22.fasta\")\r\nGENOME2.class@region.data@synonymous\r\nGENOME2.class@region.data@CodingSNPS \r\nGENOME2.class.syn <- neutrality.stats(GENOME2.class,subsites=\"syn\")\r\nGENOME2.class.syn@Tajima.D \r\nGENOME2.class.syn@theta_Watterson\r\n```\r\n13.What is theta Watterson and Tajima’s D of chromosome LGE22 for synonymous and nonsynonymous sites?\r\n\r\nAnalysing RADseq data using VCF \r\n================================\r\n\r\n```R\r\n# SPLIT VCF FILE\r\nVCF_split_into_scaffolds(\"rad/variants.vcf\",\"rad_split_vcf\") \r\n# READ IN DATA, smaller subset\r\nGENOME.class <- readData(\"rad_split_vcf_small\",format=\"VCF\") \r\npop1<-as.character(read.table(\"rad/ind_species1.txt\")[[1]]) \r\npop2<-as.character(read.table(\"rad/ind_species2.txt\")[[1]]) \r\nGENOME.class<- set.populations(GENOME.class,list(pop1,pop2),diploid=TRUE) \r\n# CHECK\r\nGENOME.class@populations\r\n```\r\nObtaining statistics from multiple VCFs derived from RADseq\r\n-----------------------------------------------------------\r\n```R\r\n# NEUTRALITY STATISTICS \r\nGENOME.class <- neutrality.stats(GENOME.class, FAST=TRUE) \r\nget.neutrality(GENOME.class)[[1]] GENOME.class@Tajima.D \r\n# FST \r\nGENOME.class <- F_ST.stats(GENOME.class)\r\nget.F_ST(GENOME.class)[[1]] \r\nGENOME.class@nucleotide.F_ST \r\n# DIVERSITY\r\nGENOME.class <- diversity.stats(GENOME.class)\r\nget.diversity(GENOME.class) \r\nGENOME.class@nuc.diversity.within \r\n# SFS\r\nGENOME.class <-detail.stats(GENOME.class,site.spectrum=TRUE,site.FST=TRUE) \r\nresults <- get.detail(GENOME.class) \r\nGENOME.class@region.stats@minor.allele.freqs\r\n```\r\n\r\n14.Plot a site-frequency-spectrum for each population.\r\n\r\n```R\r\n# Concatenate loci\r\nCON <- concatenate.regions(GENOME.class) \r\nCON <- detail.stats(CON,site.spectrum=TRUE,site.FST=TRUE) \r\nresults <-get.detail(CON) \r\nallele_Freqs <- CON@region.stats@minor.allele.freqs[[1]] \r\nfreq.table <- list()\r\nfreq.table[[1]] <- table(allele_Freqs) \r\nsfs <- data.frame(freq.table)\r\n\r\nlibrary(ggplot2) \r\nggplot(sfs, aes(x=allele_Freqs, y=Freq)) + geom_bar(stat = ’identity’)\r\n```\r\nAdditional aspects\r\n==================\r\n\r\nMore information are available in three pdfs accompanied by the program\r\n(see folder **pdf**): **An introduction to the PopGenome package**:\r\nSliding window analysis, reading SNP data files, coalescent simulations;\r\n**Whole genome analyses using PopGenome and VCF files**: Details about\r\nreading tabixed VCF files, examples, graphical output, parallel read-in,\r\npre-filtering VCF files; **Package PopGenome**: Documentation about all\r\nimplemented functions with examples\r\n\r\nIncluding features from GFF files to Fasta files\r\n------------------------------------------------\r\n\r\nIf no gff-file was specified when the data was read in, it is assumed\r\nthat the alignment is in the correct reading frame (starting at a first\r\ncodon position). The GFF folder contains GFF-files for each alignment\r\nstored in the FASTA folder. The GFF files should have the same names\r\n(without any extensions like .fas or .gff) as the corresponding FASTA\r\nfiles to ensure that sequence and annotation are matched correctly.\r\n\r\nHandling missing data and differences between readData and readVCF\r\n------------------------------------------------------------------\r\n\r\nPopGenome can use missing data, e.g. positions with gaps. Also note the\r\ndifferences between *readData* and *readVCF* for your own analysis (for\r\nfurther details see **Whole_genome_analyses_using_VCF_files.pdf**).\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}